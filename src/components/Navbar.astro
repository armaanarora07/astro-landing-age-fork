---
import { Github, LinkedinIcon, Menu, X, Sun, Moon, Facebook, Instagram } from 'lucide-react';
import XLogo from './XLogo.astro';
import Image from './Image.astro';
import { config } from '../config';

const currentPath = Astro.url.pathname;
const isHomePage = currentPath === '/';
const prefix = isHomePage ? '' : '/';
const companyName = config.app.name;
const { twitter, github, linkedin, facebook, instagram } = config.social;
const hasSocialLinks = twitter || github || linkedin || facebook || instagram;
---

<nav class="fixed w-full z-50 transition-all duration-300 py-6" id="navbar">
  <div class="max-w-7xl mx-auto px-6 flex items-center justify-between h-full">
    <a href={prefix} class="flex items-center space-x-1 text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300">
      <div class="flex items-center gap-2">
        <Image src="/images/icon/logo.png" alt="Company Logo" width={32} height={32} class="w-8 h-8" />
        <span class="text-xl font-semibold">{companyName}</span>
      </div>
    </a>
    
    <div class="flex items-center space-x-8">
      <button 
        id="theme-toggle"
        class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
        aria-label="Toggle theme"
      >
        <Sun className="w-5 h-5 hidden dark:block" />
        <Moon className="w-5 h-5 block dark:hidden" />
      </button>
      
      <button 
        id="menu-toggle"
        class="md:hidden p-2 rounded-lg text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
        aria-label="Toggle menu"
      >
        <Menu className="block w-6 h-6" id="menu-icon" />
        <X className="hidden w-6 h-6" id="close-icon" />
      </button>
      
      <div class="hidden md:flex items-center space-x-8">
        <a href="#benefits" class="text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300">Benefits</a>
        <a href="#pricing" class="text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300">Pricing</a>
        <a href="#faq" class="text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300">FAQ</a>
        {hasSocialLinks && <div class="h-4 w-px bg-gray-200 dark:bg-gray-700"></div>}
        {hasSocialLinks && (
          <div class="flex items-center space-x-4">
            {twitter && (
              <a 
                href={twitter}
                target="_blank"
                rel="noopener noreferrer"
                class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
                aria-label="Twitter Profile"
              >
                <XLogo className="w-4 h-4" />
              </a>
            )}
            {linkedin && (
              <a 
                href={linkedin}
                target="_blank"
                rel="noopener noreferrer"
                class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
                aria-label="LinkedIn Profile"
              >
                <LinkedinIcon className="w-4 h-4" />
              </a>
            )}
            {github && (
              <a 
                href={github}
                target="_blank"
                rel="noopener noreferrer"
                class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
                aria-label="GitHub Profile"
              >
                <Github className="w-4 h-4" />
              </a>
            )}
            {facebook && (
              <a 
                href={facebook}
                target="_blank"
                rel="noopener noreferrer"
                class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
                aria-label="Facebook Profile"
              >
                <Facebook className="w-4 h-4" />
              </a>
            )}
            {instagram && (
              <a 
                href={instagram}
                target="_blank"
                rel="noopener noreferrer"
                class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
                aria-label="Instagram Profile"
              >
                <Instagram className="w-4 h-4" />
              </a>
            )}
          </div>
        )}
      </div>
    </div>
  </div>
  
  <!-- Mobile menu -->
  <div 
    id="mobile-menu"
    class="fixed inset-0 bg-white dark:bg-gray-900 z-50 hidden transition-all duration-300"
  >
    <div class="flex flex-col h-full pt-24 px-6">
      <div class="flex flex-col space-y-6">
        <a 
          href="#benefits"
          class="text-2xl font-semibold text-gray-900 dark:text-white hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300"
        >
          Benefits
        </a>
        <a 
          href="#pricing"
          class="text-2xl font-semibold text-gray-900 dark:text-white hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300"
        >
          Pricing
        </a>
        <a 
          href="#faq"
          class="text-2xl font-semibold text-gray-900 dark:text-white hover:text-blue-500 dark:hover:text-blue-400 transition-all duration-300"
        >
          FAQ
        </a>
      </div>
      
      {hasSocialLinks && (
        <div class="mt-12 flex space-x-6">
          {twitter && (
            <a 
              href={twitter}
              target="_blank"
              rel="noopener noreferrer"
              class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
              aria-label="Twitter Profile"
            >
              <XLogo className="w-5 h-5" />
            </a>
          )}
          {linkedin && (
            <a 
              href={linkedin}
              target="_blank"
              rel="noopener noreferrer"
              class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
              aria-label="LinkedIn Profile"
            >
              <LinkedinIcon className="w-5 h-5" />
            </a>
          )}
          {github && (
            <a 
              href={github}
              target="_blank"
              rel="noopener noreferrer"
              class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
              aria-label="GitHub Profile"
            >
              <Github className="w-5 h-5" />
            </a>
          )}
          {facebook && (
            <a 
              href={facebook}
              target="_blank"
              rel="noopener noreferrer"
              class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
              aria-label="Facebook Profile"
            >
              <Facebook className="w-5 h-5" />
            </a>
          )}
          {instagram && (
            <a 
              href={instagram}
              target="_blank"
              rel="noopener noreferrer"
              class="p-2 rounded-full text-gray-700 hover:text-blue-500 dark:text-gray-200 dark:hover:text-blue-400 transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800"
              aria-label="Instagram Profile"
            >
              <Instagram className="w-5 h-5" />
            </a>
          )}
        </div>
      )}
    </div>
  </div>
</nav>

<script>
  function setupThemeToggle() {
    const themeToggle = document.getElementById('theme-toggle');
    if (!themeToggle) return;

    const toggleTheme = () => {
      const isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      window.dispatchEvent(new Event('themeChange'));
    };

    // Remove existing event listeners if any
    const newThemeToggle = themeToggle.cloneNode(true) as HTMLElement;
    if (themeToggle.parentNode) {
      themeToggle.parentNode.replaceChild(newThemeToggle, themeToggle);
    }
    
    // Add new event listener
    newThemeToggle.addEventListener('click', toggleTheme);
  }

  function setupMobileMenu() {
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    
    if (!menuToggle || !mobileMenu || !menuIcon || !closeIcon) return;
    
    function toggleMenu() {
      const isOpen = mobileMenu?.classList.contains('block') ?? false;
      
      if (isOpen) {
        mobileMenu?.classList.remove('block');
        mobileMenu?.classList.add('hidden');
        menuIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        document.body.style.overflow = '';
      } else {
        mobileMenu?.classList.remove('hidden');
        mobileMenu?.classList.add('block');
        menuIcon?.classList.add('hidden');
        closeIcon?.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
    }
    
    // Remove old event listeners
    const newMenuToggle = menuToggle.cloneNode(true) as HTMLElement;
    menuToggle.parentNode?.replaceChild(newMenuToggle, menuToggle);
    
    // Add new event listeners
    newMenuToggle.addEventListener('click', toggleMenu);
    
    // Close menu when clicking links
    const menuLinks = mobileMenu.querySelectorAll('a');
    menuLinks.forEach(link => {
      link.addEventListener('click', () => {
        setTimeout(toggleMenu, 100);
      });
    });
  }

  function setupNavbarScroll() {
    const navbar = document.getElementById('navbar');
    let scrolled = false;
    
    const handleScroll = () => {
      if (window.scrollY > 50 && !scrolled) {
        navbar?.classList.add('bg-white/80', 'dark:bg-gray-900/80', 'backdrop-blur-lg', 'shadow-sm');
        scrolled = true;
      } else if (window.scrollY <= 50 && scrolled) {
        navbar?.classList.remove('bg-white/80', 'dark:bg-gray-900/80', 'backdrop-blur-lg', 'shadow-sm');
        scrolled = false;
      }
    };

    window.removeEventListener('scroll', handleScroll);
    window.addEventListener('scroll', handleScroll);
    
    // Check initial scroll position
    handleScroll();
  }

  function setupSmoothScrolling() {
    // Get all internal links (those that start with #)
    const navLinks = document.querySelectorAll('a[href^="#"]:not([href="#"])');
    
    navLinks.forEach(link => {
      // Clean the original event listeners
      const newLink = link.cloneNode(true) as HTMLAnchorElement;
      if (link.parentNode) {
        link.parentNode.replaceChild(newLink, link);
      }
      
      // Add smooth scrolling
      newLink.addEventListener('click', (e) => {
        e.preventDefault();
        
        // Get the target element
        const targetId = newLink.getAttribute('href');
        if (!targetId) return;
        
        const targetElement = document.querySelector(targetId);
        if (!targetElement) return;
        
        // Account for fixed navbar with some extra padding
        const navbarHeight = document.getElementById('navbar')?.offsetHeight || 0;
        const targetPosition = targetElement.getBoundingClientRect().top + window.pageYOffset - navbarHeight - 20;
        
        // Smooth scroll to the target
        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
        
        // Update the URL but don't scroll (we already did that)
        history.pushState(null, '', targetId);
      });
    });
  }

  function initializeAll() {
    setupThemeToggle();
    setupMobileMenu();
    setupNavbarScroll();
    setupSmoothScrolling();
  }

  // Run on page load
  initializeAll();

  // Rerun after navigation
  document.addEventListener('astro:page-load', initializeAll);
  window.addEventListener('hashchange', initializeAll);
</script>